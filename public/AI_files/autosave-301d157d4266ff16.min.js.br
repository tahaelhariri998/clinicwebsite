"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="073c1bd6-f02a-5253-ad98-bd797994dd80")}catch(e){}}();
(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[5817],{879126:(e,a,t)=>{t.d(a,{AX:()=>f,Ay:()=>v,DA:()=>E,DD:()=>n,Fz:()=>y,IC:()=>k,Jm:()=>o,MV:()=>m,Ns:()=>h,O2:()=>d,QW:()=>w,Vw:()=>N,Vz:()=>u,dd:()=>i,eX:()=>r,fH:()=>x,hL:()=>_,ho:()=>c,jO:()=>p,ns:()=>A,r_:()=>g,rf:()=>s,yl:()=>l});let l="autosave_modal--modal--Egqg3",n="autosave_modal--title--Q-T-o",s="autosave_modal--body--pv4yP",o="autosave_modal--openFilesToSyncText--DI5lk",r="autosave_modal--fileRows--JQWy9",c="autosave_modal--fileRow--vBNLB",i="autosave_modal--userRows--fG3Qq",u="autosave_modal--onlyFileRow--yr2jI autosave_modal--fileRow--vBNLB autosave_modal--body--pv4yP",m="autosave_modal--onlyFileRowText--NGT-7",d="autosave_modal--userTitle--lEP2M ellipsis--ellipsis--Tjyfa text--fontPos11--2LvXf text--_fontBase--QdLsd",v="autosave_modal--fileMetadata--JIecy",E="autosave_modal--fileTitle--L9HsU ellipsis--ellipsis--Tjyfa",_="autosave_modal--fileLastUpdatedAt--ZL15q ellipsis--ellipsis--Tjyfa text--fontPos11--2LvXf text--_fontBase--QdLsd",f="autosave_modal--logOutButtons--961-N",g="autosave_modal--logOutDiscard--MvTW-",y="autosave_modal--logOutDone--cjhVr autosave_modal--flexRowEnd--UaYDp",h="autosave_modal--doneAndSync---UvWx autosave_modal--flexRowEnd--UaYDp",p="autosave_modal--expiryAndDone--ck-oP",N="autosave_modal--done--F-hm3",x="autosave_modal--expiryWrapper--1Ee1U",k="autosave_modal--expiry--E2Ybr",w="autosave_modal--warningIcon--T1wLu",A="autosave_modal--openToSync--KQUfj"},275081:(e,a,t)=>{t.r(a),t.d(a,{AutosaveLearnMoreModal:()=>m});var l=t(411855),n=t(188507),s=t(463033),o=t(799569),r=t(939863),c=t(662275),i=t(488578),u=t(879126);function m({userInOrg:e}){let a=(0,n.wA)(),t=l.createElement(s.$n,{variant:"secondary",onClick:()=>{a(c.Ce())}},(0,r.tx)("autosave.learn_more.done_button"));return l.createElement(i.aF,{className:u.yl},l.createElement(o.s_,{dispatch:a}),l.createElement("div",{className:u.DD},(0,r.tx)("autosave.learn_more.title")),l.createElement("div",{className:u.rf},(0,r.tx)("autosave.learn_more.body_save_pending_changes")),l.createElement("div",{className:u.rf},(0,r.tx)("autosave.learn_more.body_use_version_history")),l.createElement("div",{className:u.Fz},t))}},714932:(e,a,t)=>{t.r(a),t.d(a,{AutosaveLogOutModal:()=>Z,HasAutosaveChangesModal:()=>X});var l=t(411855),n=t(188507),s=t(943632),o=t(414507),r=t(463033),c=t(951792),i=t(288006),u=t(862350),m=t(677469),d=t.n(m),v=t(297666),E=t(517333),_=t(737947),f=t(966712),g=t(776621),y=t(799569),h=t(946689),p=t(564577),N=t(163023),x=t(331737),k=t(842262),w=t(869381),A=t(154254),C=t(939863),D=t(119198),F=t(662275),b=t(788811),L=t(823699),O=t(63104),S=t(132367),T=t(860178),$=t(132135),M=t(565167),j=t(945020),B=t(754168),R=t(488578),U=t(879126),I=t(247866);function P(){return(0,f.kc)().ss_fpl_multiplayer}function z(e){return e.user?l.createElement("div",{className:U.O2},l.createElement("p",null,e.user.community_profile_handle||e.user.email)):null}async function V(e,a){let t=!1,l=null;try{let{data:n}=await B.S.getFiles({includePerms:!0,fileKey:a.fileKey,args:{headers:{"X-Figma-User-ID":e}}});(l=n.meta)&&(l.deleted_at||!l.can_edit_canvas)&&(t=!0)}catch(e){404===e.status?t=!0:(0,g.Lo)("Autosave","Failed to retrieve information about autosave file")}return{userID:e,shouldDeleteFile:t,unsyncedFile:a,figFile:l}}let W=(e,a)=>(0,v.s)(()=>{let t=new URL((0,$.r1)(e,!0));t.searchParams.append("fuid",a),_.Ay.redirect(t.toString(),"_blank")}),G=(e,a)=>(0,v.s)(()=>e(D.NA({file:a,openNewFileIn:j.ai.NEW_TAB,source:M.U.AUTOSAVE_MODAL})));function K(e,a,t){return(0,O.y8)(a)?{fileName:a.file.name,onClick:W(a.file,t.id),thumbnail:l.createElement(x.NU,{file:a.file,size:w.y.SMALL,borderRadius:4})}:{fileName:a.name,onClick:G(e,a),thumbnail:l.createElement(k.A,{listView:"slightly-larger"})}}function Y(e){let{fileName:a,onClick:t,thumbnail:s}=K((0,n.wA)(),e.fileState,e.user);return l.createElement("div",{className:U.ho,key:e.fileState.fileKey},l.createElement("div",{className:A.cx.hFull.$},s),l.createElement("div",{className:U.Ay},l.createElement("div",{className:U.DA},a),l.createElement("div",{className:U.hL},(0,C.tx)("tile.file_tile.edited_time",{time:l.createElement(p.h1,{date:e.fileState.lastUpdatedAt})}))),P()?l.createElement("div",{className:U.ns},l.createElement(r.$n,{variant:"secondary",onClick:t},(0,C.tx)("autosave.has_changes.open_to_sync"))):l.createElement(h.nR,{className:U.ns,onClick:t},(0,C.tx)("autosave.has_changes.open_to_sync")))}function Q(e){return l.createElement("div",{className:U.dd},Object.keys(e.files).map(a=>l.createElement("div",{key:a,className:U.eX},l.createElement(z,{user:e.users.filter(e=>e?.id===a)[0]}),l.createElement("div",null,Object.values(e.files[a]).map(t=>l.createElement(Y,{fileState:t,user:e.users.filter(e=>e?.id===a)[0],key:t.fileKey}))))))}function H({modalManager:e,files:a,nextGarbageCollectionTimestamp:t,users:s,includeDismissButton:o,onDone:u}){let m;let v=(0,n.wA)(),E=u||(()=>{v(F.Ce())}),_=q(t),f=(0,C.tx)("autosave.has_changes.sync_offline_changes"),g=1===d()(Object.values(a)).length,p=null,x=null,k=null,w=null,D=null;if(g){p=d()(Object.values(a))[0];let e=Object.keys(a).filter(e=>a[e].length>0)[0],t=K(v,p,x=s.filter(a=>a?.id===e)[0]);k=t.fileName,w=t.onClick,D=t.thumbnail,m=l.createElement(l.Fragment,null,l.createElement(z,{user:x}),l.createElement("div",{className:U.Vz},l.createElement("div",{className:A.cx.hFull.$},D),l.createElement("div",{className:U.MV},(0,C.tx)("autosave.has_changes.unsaved_changes_to_file",{fileName:l.createElement("span",{className:U.DD},k)}))))}else m=l.createElement(l.Fragment,null,l.createElement("div",{className:U.Jm},(0,C.tx)("autosave.has_changes.unsynced_changes_offline")),l.createElement(Q,{files:a,users:s}));let b=_&&l.createElement("div",{className:U.fH},l.createElement(N.B,{svg:I.A,className:U.QW}),l.createElement("div",{className:U.IC},_)),L=o&&(P()?l.createElement(r.$n,{variant:"secondary",onClick:E},(0,C.tx)("autosave.has_changes.dismiss.later")):l.createElement(h.nR,{onClick:E},(0,C.tx)("autosave.has_changes.dismiss.later"))),O=g&&w&&(P()?l.createElement(r.$n,{variant:"primary",onClick:w},(0,C.tx)("autosave.has_changes.open_to_sync")):l.createElement(h.$$,{onClick:w},(0,C.tx)("autosave.has_changes.open_to_sync")));return P()?l.createElement(c.bL,{manager:e,width:"lg"},l.createElement(i.vo,null,l.createElement(i.Y9,null,l.createElement(i.hE,null,f)),l.createElement(i.nB,null,m),(b||L||O)&&l.createElement(i.wi,null,b,(L||O)&&l.createElement(i.jk,null,L,O)))):l.createElement(R.aF,{className:U.yl,size:500,tintedModalBackground:!0},l.createElement(y.s_,{dispatch:v}),l.createElement("div",{className:U.DD},f),l.createElement("div",null,m),(b||L||O)&&l.createElement("div",{className:U.jO},b,l.createElement("div",{className:U.Ns},L,O)))}function X(e){let a=u.hS(e),{unsyncedFiles:t,localUnsyncedFiles:s}=(0,b.Gg)(),o=(0,n.d4)(e=>e.modalShown),r=(0,n.d4)(e=>e.autosave.nextGarbageCollectionTimestamp),c=(0,T.iZ)(),i=c?.id;return o&&i&&c?l.createElement(H,{modalManager:a,files:{[i]:[...t,...s]},nextGarbageCollectionTimestamp:r,users:[c],includeDismissButton:!0}):null}function J(e){let a=u.hS(e),t=(0,n.wA)(),[s,o]=l.useState(!1),[m,d]=l.useState(!1),v=async()=>{try{for(let a of e.users){let e=a?.id;e&&await (0,b.go)((0,L.cu)(e))}}finally{d(!0)}},_=()=>{t(F.Lo())},f=()=>{o(!0)},g=0===Object.values(e.files).length;if(m||g&&e.loaded){let n=(0,C.tx)("autosave.logout.offline_changes"),s=m?(0,C.tx)("autosave.logout.offline_changes_discarded"):(0,C.tx)("autosave.logout.offline_changes_synced"),o=P()?l.createElement(r.$n,{variant:"secondary",onClick:e.onLogOut},(0,C.tx)("autosave.logout.log_out")):l.createElement(h.nR,{onClick:e.onLogOut},(0,C.tx)("autosave.logout.log_out"));return P()?l.createElement(c.bL,{width:"md",manager:a},l.createElement(i.vo,null,l.createElement(i.Y9,null,l.createElement(i.hE,null,n)),l.createElement(i.nB,null,s),l.createElement(i.wi,null,l.createElement(i.jk,null,o)))):l.createElement(R.aF,{className:U.yl,size:384,tintedModalBackground:!0},l.createElement(y.s_,{dispatch:t}),l.createElement("div",{className:U.DD},n),l.createElement("div",{className:U.rf},s),l.createElement("div",{className:U.Vw},o))}if(s)return l.createElement(H,{...e,modalManager:a,onDone:()=>{o(!1)}});{let n,s,o;let u=(0,C.tx)("autosave.has_changes.sync_offline_changes"),m=E.eD?(0,C.t)("autosave.logout.log_out_text.desktop"):(0,C.t)("autosave.logout.log_out_text.web");return E.eD?(n=P()?l.createElement(r.$n,{variant:"destructiveSecondary",onClick:v},(0,C.tx)("autosave.logout.discard_and_logout")):l.createElement(h.s6,{onClick:v},(0,C.tx)("autosave.logout.discard_and_logout")),s=P()?l.createElement(r.$n,{variant:"secondary",onClick:_},(0,C.tx)("autosave.logout.cancel")):l.createElement(h.nR,{onClick:_},(0,C.tx)("autosave.logout.cancel")),o=P()?l.createElement(r.$n,{variant:"secondary",onClick:f},(0,C.tx)("autosave.logout.show_changes")):l.createElement(h.nR,{onClick:f},(0,C.tx)("autosave.logout.show_changes"))):(n=P()?l.createElement(r.$n,{variant:"destructiveSecondary",onClick:v},(0,C.tx)("autosave.logout.discard")):l.createElement(h.s6,{onClick:v},(0,C.tx)("autosave.logout.discard")),s=P()?l.createElement(r.$n,{variant:"secondary",onClick:e.onLogOut},(0,C.tx)("autosave.logout.log_out")):l.createElement(h.nR,{onClick:e.onLogOut},(0,C.tx)("autosave.logout.log_out")),o=P()?l.createElement(r.$n,{variant:"primary",onClick:f},(0,C.tx)("autosave.logout.sync_changes")):l.createElement(h.$$,{onClick:f},(0,C.tx)("autosave.logout.sync_changes"))),P()?l.createElement(c.bL,{manager:a,width:"lg"},l.createElement(i.vo,null,l.createElement(i.Y9,null,l.createElement(i.hE,null,u)),l.createElement(i.nB,null,m),l.createElement(i.wi,null,n,l.createElement(i.jk,null,s,o)))):l.createElement(R.aF,{className:U.yl,size:424,tintedModalBackground:!0},l.createElement(y.s_,{dispatch:t}),l.createElement("div",{className:U.DD},u),l.createElement("div",{className:U.rf},m),l.createElement("div",{className:U.AX},l.createElement("div",{className:U.r_},n),l.createElement("div",{className:U.Fz},s,o)))}}function Z(e){let{multiUserUnsyncedFiles:a,multiUserGarbageCollectionTimestamp:t,loaded:r,autosaveFilesToDelete:c}=function(e){let a=(0,n.wA)(),[t,r]=l.useState({multiUserGarbageCollectionTimestamp:0,multiUserUnsyncedFiles:{},loaded:!1,autosaveFilesToDelete:[]});return l.useEffect(()=>{let a=async()=>{try{let a=await (0,b.ZW)((0,s.WI)(e.map(e=>e?.id))),t={},l=[],n=[];for(let[e,l]of Object.entries(a)){for(let a of l.unsyncedFiles)n.push(V(e,a));for(let a of l.newFiles)e in t||(t[e]=[]),t[e].push(a)}for(let e of(await Promise.all(n))){let a=e.userID;e.shouldDeleteFile?l.push({userID:a,fileKey:e.unsyncedFile.fileKey}):e.figFile&&(a in t||(t[a]=[]),t[a].push({type:"autosave-file",fileKey:e.figFile.key,lastUpdatedAt:e.unsyncedFile.lastUpdatedAt,file:e.figFile}))}let o=Math.min(...Object.values(a).map(e=>e.nextGarbageCollectionTimestamp));r({multiUserGarbageCollectionTimestamp:o,multiUserUnsyncedFiles:t,loaded:!0,autosaveFilesToDelete:l})}catch(e){e instanceof Error?((0,g.x1)("Autosave","Failed to call autosave callback",{name:e.name,message:e.message}),(0,g.$D)(o.FigmaTeam.SCENEGRAPH_AND_SYNC,e)):(0,g.$D)(o.FigmaTeam.SCENEGRAPH_AND_SYNC,Error("Failed to call autosave callback"))}};return S.hp.register(S.a,a),a(),function(){S.hp.unregister(S.a,a)}},[a,e]),t}(e.users);return(0,T.TA)()?l.createElement(J,{...e,loaded:r,nextGarbageCollectionTimestamp:t,files:a,onLogOut:()=>{for(let e of c)(0,b.go)((0,L.Zt)(e.userID,e.fileKey)).catch(e=>{(0,g.$D)(o.FigmaTeam.UNOWNED,Error("Failed to delete autosave data for sessions"))});e.onLogOut()},users:e.users}):null}X.displayName="HasAutosaveChangesModal";let q=e=>{let a=Math.floor(((0,b.bD)()-(Date.now()-e))/864e5);return a>5?null:a<1?(0,C.tx)("autosave.has_changes.expiry_text_shortly"):(0,C.tx)("autosave.has_changes.expiry_text_days",{days:a})};Z.displayName="AutosaveLogOutModal"},528752:(e,a,t)=>{t.r(a),t.d(a,{AutosaveNewFileAlreadyOpenModal:()=>g});var l=t(411855),n=t(188507),s=t(862350),o=t(951792),r=t(288006),c=t(463033),i=t(776250),u=t(966712),m=t(946689),d=t(154254),v=t(939863),E=t(662275),_=t(488578),f=t(879126);function g(e){let a=(0,n.wA)();(0,l.useEffect)(()=>(0,i.sx)("New Autosave File Already Open Modal Shown"));let t=()=>a(E.Ce()),g=s.hS({open:!0,onClose:t});return(0,u.kc)().ss_fpl_multiplayer?l.createElement(o.bL,{manager:g,width:360},l.createElement(r.vo,null,l.createElement(r.Y9,null,l.createElement(r.hE,null,(0,v.tx)("autosave.file_already_open_modal.title"))),l.createElement(r.nB,null,(0,v.tx)("autosave.file_already_open_modal.body",{fileName:l.createElement("span",{className:d.cx.fontSemiBold.$},e.file.name)})),l.createElement(r.wi,null,l.createElement(r.jk,null,l.createElement(c.$n,{variant:"secondary",onClick:t},(0,v.tx)("general.ok")))))):l.createElement(_.aF,{size:360,tintedModalBackground:!0},l.createElement("div",{className:f.DD},(0,v.tx)("autosave.file_already_open_modal.title")),l.createElement("div",{className:f.rf},(0,v.tx)("autosave.file_already_open_modal.body",{fileName:l.createElement("span",{className:d.cx.fontSemiBold.$},e.file.name)})),l.createElement("div",{className:f.Vw},l.createElement(m.nR,{onClick:t},(0,v.tx)("general.ok"))))}g.displayName="AutosaveNewFileAlreadyOpenModal"}}]);

//# debugId=073c1bd6-f02a-5253-ad98-bd797994dd80

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/2e7635570e3756d67ff164a7ebaeaa2900998947/autosave-301d157d4266ff16.min.js.map